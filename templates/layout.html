<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wall Charts</title>
    <link rel=stylesheet type=text/css href="{{ url_for('static',
    filename='style.css') }}">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
  </head>
  <body>
    {% if session.logged_in %}
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="{{ url_for('homepage') }} "
          >Wall Charts</a
        >
        {% if session.department_id == 0 %}
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class=" navbar-collapse collapse"
          id="navbarSupportedContent"
        >
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >Admin</a
              >
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li class="dropdown-item">
                  <a class="nav-link" href="{{ url_for('units') }}">
                    Manage Units</a
                  >
                </li>
                <li class="dropdown-item">
                  <a class="nav-link" href="{{ url_for('users') }}">
                    Manage Users</a
                  >
                </li>
                <li class="dropdown-item">
                  <a class="nav-link" href="{{ url_for('upload_record') }}">
                    Upload Record</a
                  >
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('structure_tests') }}">
                Structure Tests</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('departments') }}">
                Departments</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('find_worker') }}">
                Find Worker</a
              >
            </li>
          </ul>

          {% endif %} {% endif %}
          {% if not session.logged_in %}
            <a  href="{{ url_for('login') }}">Log in</a>
            {% else %}
            <a  href="{{ url_for('logout') }}">Log out</a>
            {% endif %}
      </div>
    </nav>

    <div class="page container">
      {% for message in get_flashed_messages() %}
      <div class="alert alert-primary">{{ message }}</div>
      {% endfor %} {% block body %}{% endblock %}
    </div>
  </body>
  <script>
    const toggleBurgerButton = document.querySelector(".navbar-toggler");
    const toggleBurgerIcon = document.querySelector(".navbar-toggler-icon");
    const toggleAdminMenu = document.querySelector(".dropdown-menu");
    const toggleAdminButton = document.querySelector(".dropdown-toggle");
    const navbar = document.querySelector(".navbar");

    navbar.addEventListener("click", (e) => {
      console.log(
        e.target === toggleBurgerButton || e.target === toggleBurgerIcon
      );
      if (e.target === toggleBurgerButton || e.target === toggleBurgerIcon) {
        const navMenu = document.querySelector(".navbar-collapse");
        navMenu.classList.toggle("show");
        toggleBurgerButton.classList.toggle("collapsed");
        if (!navMenu.classList.contains("show")) {
          toggleAdminButton.classList.remove("show");
          toggleAdminMenu.classList.remove("show");
        }
      }
      if (e.target === toggleAdminButton) {
        toggleAdminButton.classList.toggle("show");
        toggleAdminMenu.classList.toggle("show");
      }
    });

    const currentLocation = window.location.href;
    const navLinks = Array.from(document.querySelectorAll(".nav-link"));
    const adminDropdown = document.querySelector(".dropdown-toggle");

    navLinks.map((link, index) => {
   if (currentLocation.includes("/users/") || currentLocation.includes("/units/") || currentLocation.includes("/upload_record")){
        adminDropdown.classList.add("active");
        adminDropdown.setAttribute("aria-current", "page");
      } else if (currentLocation.includes(link.href)) {
        navLinks[index].classList.add("active");
        navLinks[index].setAttribute("aria-current", "page");
      }
    });
  </script>
</html>
